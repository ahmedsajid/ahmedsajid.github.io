<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Jenkins EC2 plugin worker AMI selection based on Resource Tags | Ahmed Sajid's Personal Web</title>
<meta name=keywords content="Jenkins,Build,EC2,AMI,AWS">
<meta name=description content="TL;DR, Jenkins EC2 plugin has the option for worker AMIs to be selected based on Tags and NOT just a hardcoded AMI ID. This comes in handy when you have an automated build pushing out AMIs with the same tags on regular basis, eliminating the need for manually updating hardcoded AMI to latest version in Jenkins EC2 cloud configuration.
Long version&mldr;&mldr;
Most companies managing their own Jenkins CI Build system on AWS Cloud must be familiar with the ec2-plugin.">
<meta name=author content="Ahmed Sajid">
<link rel=canonical href=https://ahmedsajid.io/posts/jenkins-ec2-plugin-tags-filter/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://ahmedsajid.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://ahmedsajid.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://ahmedsajid.io/favicon-32x32.png>
<link rel=apple-touch-icon href=https://ahmedsajid.io/apple-touch-icon.png>
<link rel=mask-icon href=https://ahmedsajid.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.92.1">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QVDXPX8C7C"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-QVDXPX8C7C',{anonymize_ip:!1})}</script>
<meta property="og:title" content="Jenkins EC2 plugin worker AMI selection based on Resource Tags">
<meta property="og:description" content="TL;DR, Jenkins EC2 plugin has the option for worker AMIs to be selected based on Tags and NOT just a hardcoded AMI ID. This comes in handy when you have an automated build pushing out AMIs with the same tags on regular basis, eliminating the need for manually updating hardcoded AMI to latest version in Jenkins EC2 cloud configuration.
Long version&mldr;&mldr;
Most companies managing their own Jenkins CI Build system on AWS Cloud must be familiar with the ec2-plugin.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://ahmedsajid.io/posts/jenkins-ec2-plugin-tags-filter/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-02-06T22:00:00-05:00">
<meta property="article:modified_time" content="2022-02-06T22:00:00-05:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Jenkins EC2 plugin worker AMI selection based on Resource Tags">
<meta name=twitter:description content="TL;DR, Jenkins EC2 plugin has the option for worker AMIs to be selected based on Tags and NOT just a hardcoded AMI ID. This comes in handy when you have an automated build pushing out AMIs with the same tags on regular basis, eliminating the need for manually updating hardcoded AMI to latest version in Jenkins EC2 cloud configuration.
Long version&mldr;&mldr;
Most companies managing their own Jenkins CI Build system on AWS Cloud must be familiar with the ec2-plugin.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://ahmedsajid.io/posts/"},{"@type":"ListItem","position":3,"name":"Jenkins EC2 plugin worker AMI selection based on Resource Tags","item":"https://ahmedsajid.io/posts/jenkins-ec2-plugin-tags-filter/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Jenkins EC2 plugin worker AMI selection based on Resource Tags","name":"Jenkins EC2 plugin worker AMI selection based on Resource Tags","description":"TL;DR, Jenkins EC2 plugin has the option for worker AMIs to be selected based on Tags and NOT just a hardcoded AMI ID. This comes in handy when you have an automated build pushing out AMIs with the same tags on regular basis, eliminating the need for manually updating hardcoded AMI to latest version in Jenkins EC2 cloud configuration.\nLong version\u0026hellip;\u0026hellip;\nMost companies managing their own Jenkins CI Build system on AWS Cloud must be familiar with the ec2-plugin.","keywords":["Jenkins","Build","EC2","AMI","AWS"],"articleBody":"TL;DR, Jenkins EC2 plugin has the option for worker AMIs to be selected based on Tags and NOT just a hardcoded AMI ID. This comes in handy when you have an automated build pushing out AMIs with the same tags on regular basis, eliminating the need for manually updating hardcoded AMI to latest version in Jenkins EC2 cloud configuration.\nLong version……\nMost companies managing their own Jenkins CI Build system on AWS Cloud must be familiar with the ec2-plugin.\nDuring my recently experience with a Jenkins setup, I found that AMI IDs were hardcoded pointing to images that were built 2 years ago. This stood out to me as a security issue, something to be dealt with right away.\nI went on a journey to figure out how to automate the process of changing the AMI on regular basis with ID of latest AMI available. Since the AMI build job already existed, all I had to do was to introduce a post-build step to update Jenkins Cloud configuration with a newly built AMI.\nSimple, right? Yeah it seemed the same to me, when I came across this PR. Some of the folks came up with a great solution which works, but has a downside. You will have to ‘Approve’ this script within Jenkins as it considers it dangerous and might pose a security problem.\nApproving something that can have negative consequences, just didn’t sound like a great solution. I wasn’t ready to compromise on security to have a piece of automation to solve this issue.\nAfter a few days of researching, I came across this JIRA. This particular individual was having same issue when another user pointed to a feature that might help.\nFor those have worked with such a setup before probably know a simpler solution, which as you can see, I didn’t find until much later in the game.\nI feel that this is one of the GREAT features of this plugin and I was unable to find any documentation around it. I could have simply provided a list of tags to filter AMIs by and based on these tags, the plugin looks up the AMI to be the Jenkins Worker node on EC2. If there are more than 1 AMIs matching the filter, it will choose the one with latest creation date.\nIn this example you can see that I have specified multiple tags such as name, builder and os and their values as the AMI Filters.\nYou could say that I wasn’t just looking hard enough. You would be correct! I wasn’t looking hard enough in the right place.\nI hope this helps someone else going through the same struggles of figuring out this problem.\nFor more info see the actual PR which implemented this great feature.\n","wordCount":"461","inLanguage":"en","datePublished":"2022-02-06T22:00:00-05:00","dateModified":"2022-02-06T22:00:00-05:00","author":[{"@type":"Person","name":"Ahmed Sajid"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://ahmedsajid.io/posts/jenkins-ec2-plugin-tags-filter/"},"publisher":{"@type":"Organization","name":"Ahmed Sajid's Personal Web","logo":{"@type":"ImageObject","url":"https://ahmedsajid.io/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://ahmedsajid.io accesskey=h title="Ahmed Sajid's Personal Web (Alt + H)">Ahmed Sajid's Personal Web</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://ahmedsajid.io title=Home>
<span>Home</span>
</a>
</li>
<li>
<a href=https://ahmedsajid.io/resume title=Resume>
<span>Resume</span>
</a>
</li>
<li>
<a href=https://ahmedsajid.io/search/ title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li>
<li>
<a href=https://ahmedsajid.io/tags/ title=Tags>
<span>Tags</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://ahmedsajid.io>Home</a>&nbsp;»&nbsp;<a href=https://ahmedsajid.io/posts/>Posts</a></div>
<h1 class=post-title>
Jenkins EC2 plugin worker AMI selection based on Resource Tags
</h1>
<div class=post-meta><span title="2022-02-06 22:00:00 -0500 -0500">February 6, 2022</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Ahmed Sajid&nbsp;|&nbsp;<a href=https://github.com/ahmedsajid/ahmedsajid.io/tree/web/content/posts/Jenkins-EC2-Plugin-Tags-Filter.md rel="noopener noreferrer" target=_blank>Suggest Changes</a>
</div>
</header>
<div class=post-content><p>TL;DR, Jenkins EC2 plugin has the option for worker AMIs to be selected based on Tags and NOT just a hardcoded AMI ID. This comes in handy when you have an automated build pushing out AMIs with the same tags on regular basis, eliminating the need for manually updating hardcoded AMI to latest version in Jenkins EC2 cloud configuration.</p>
<p>Long version&mldr;&mldr;</p>
<p>Most companies managing their own Jenkins CI Build system on AWS Cloud must be familiar with the <a href=https://plugins.jenkins.io/ec2/>ec2-plugin</a>.</p>
<p>During my recently experience with a Jenkins setup, I found that AMI IDs were hardcoded pointing to images that were built 2 years ago. This stood out to me as a security issue, something to be dealt with right away.</p>
<p>I went on a journey to figure out how to automate the process of changing the AMI on regular basis with ID of latest AMI available. Since the AMI build job already existed, all I had to do was to introduce a post-build step to update Jenkins Cloud configuration with a newly built AMI.</p>
<p>Simple, right? Yeah it seemed the same to me, when I came across this <a href=https://github.com/jenkinsci/ec2-plugin/pull/154>PR</a>. Some of the folks came up with a great solution which works, but has a downside. You will have to &lsquo;Approve&rsquo; this script within Jenkins as it considers it dangerous and might pose a security problem.</p>
<p>Approving something that can have negative consequences, just didn&rsquo;t sound like a great solution. I wasn&rsquo;t ready to compromise on security to have a piece of automation to solve this issue.</p>
<p>After a few days of researching, I came across this <a href=https://issues.jenkins.io/browse/JENKINS-63917>JIRA</a>. This particular individual was having same issue when another user pointed to a feature that might help.</p>
<p>For those have worked with such a setup before probably know a simpler solution, which as you can see, I didn&rsquo;t find until much later in the game.</p>
<p>I feel that this is one of the GREAT features of this plugin and I was unable to find any documentation around it. I could have simply provided a list of tags to filter AMIs by and based on these tags, the plugin looks up the AMI to be the Jenkins Worker node on EC2. If there are more than 1 AMIs matching the filter, it will choose the one with latest creation date.</p>
<p align=center>
<img src=/img/JenkinsEC2TagsFiltering.jpg alt="Jenkins EC2 Plugin AMI Filtering based on Resource Tags">
</p>
<p>In this example you can see that I have specified multiple tags such as <code>name</code>, <code>builder</code> and <code>os</code> and their values as the AMI Filters.</p>
<p>You could say that I wasn&rsquo;t just looking hard enough. You would be correct! I wasn&rsquo;t looking hard enough in the right place.</p>
<p>I hope this helps someone else going through the same struggles of figuring out this problem.</p>
<p>For more info see the actual <a href=https://github.com/jenkinsci/ec2-plugin/pull/533>PR</a> which implemented this great feature.</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://ahmedsajid.io/tags/jenkins/>Jenkins</a></li>
<li><a href=https://ahmedsajid.io/tags/build/>Build</a></li>
<li><a href=https://ahmedsajid.io/tags/ec2/>EC2</a></li>
<li><a href=https://ahmedsajid.io/tags/ami/>AMI</a></li>
<li><a href=https://ahmedsajid.io/tags/aws/>AWS</a></li>
</ul>
<nav class=paginav>
<a class=next href=https://ahmedsajid.io/posts/bazel-build-system/>
<span class=title>Next Page »</span>
<br>
<span>Bazel: Multi language Build Software for Monorepos</span>
</a>
</nav>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=https://ahmedsajid.io>Ahmed Sajid's Personal Web</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>